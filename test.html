<!DOCTYPE html>
<html>
  <head>
    <title>Page Title</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="main-container">
      <!-- theme-toggler toggle theme better light and dark -->
      <button class="theme-toggler text-2xl dark:text-white text-dark relative">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
          />
        </svg>

        <span
          class="invisible theme-toggler-focus-within:visible theme-dropdown absolute top-16 -left-1/2 -translate-x-1/2 bg-gray-50 dark:bg-black rounded-xl"
        >
          <ul>
            <li>
              <a
                href=""
                data-mode="light"
                class="flex items-center gap-4 px-8 py-2 hover:bg-gray-100 dark:hover:text-black theme-link"
              >
                <span
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                    /></svg
                ></span>
                Light</a
              >
            </li>
            <li>
              <a
                href=""
                data-mode="dark"
                class="flex items-center gap-4 px-8 py-2 hover:bg-gray-100 dark:hover:text-black theme-link"
              >
                <span
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                    /></svg
                ></span>
                Dark</a
              >
            </li>
            <li>
              <a
                href=""
                data-mode="system"
                class="flex items-center gap-4 px-8 py-2 hover:bg-gray-100 dark:hover:text-black theme-link"
              >
                <span
                  ><svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    /></svg
                ></span>
                System</a
              >
            </li>
          </ul>
        </span>
      </button>
    </div>
    <!-- --------- -->

    <script>
      /////////////////////////////////////////////////////////

      ///// toggles theme and change Icon ///////////
      const themeTogglers = document.querySelectorAll('.theme-toggler');
      const mainContainer = document.querySelector('.main-container');

      /////////// toggles theme dropdown ////////////////////////
      themeTogglers.forEach((themeToggler) => {
        themeToggler.addEventListener('click', function () {
          console.log('hehllo');
          let themeDropdown = themeToggler.querySelector('.theme-dropdown');
          toggleClass(themeDropdown, 'invisible');
        });
      });
      ////////////////////////////////////////////////////

      ////////////close theme dropdown on outside click ////////////////
      document.addEventListener('click', function (e) {
        themeTogglers.forEach((toggle) => {
          if (!(toggle === e.target.closest('.theme-toggler'))) {
            toggle.querySelector('.theme-dropdown').classList.add('invisible');
          }
        });
      });
      /////////////////////////////////////////////////////////

      /////////////////// set active theme //////////////////////////
      const setActiveTheme = (theme) => {
        if (theme === 'dark') {
          mainContainer.classList.add('dark');
          let activeTheme = document.querySelectorAll("[data-mode='dark']");
          activeTheme.forEach((theme) => {
            theme.classList.add('active-theme');
          });
        } else if (theme === 'light') {
          mainContainer.classList.remove('dark');
          let activeTheme = document.querySelectorAll("[data-mode='light']");
          activeTheme.forEach((theme) => {
            theme.classList.add('active-theme');
          });
        } else {
          setSystemDefaultTheme();
          let activeTheme = document.querySelectorAll("[data-mode='system']");
          activeTheme.forEach((theme) => {
            theme.classList.add('active-theme');
          });
        }
      };
      /////////////////////////////////////////////////////////////////

      //////////////////// set theme on load //////////////////////////////
      window.onload = function () {
        let theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          setActiveTheme('dark');
        } else if (theme === 'light') {
          setActiveTheme('light');
        } else {
          setActiveTheme('default');
        }
      };
      //////////////////////////////////////////////////

      ////////// change theme ////////////////////
      const themeLinks = document.querySelectorAll('.theme-link');

      themeLinks.forEach((themeLink) => {
        themeLink.addEventListener('click', function (e) {
          e.preventDefault();
          ////// remove current active-theme class
          let activeTheme = document.querySelectorAll('.active-theme');
          activeTheme.forEach((theme) => {
            theme.classList.remove('active-theme');
          });

          /////// switch theme
          switch (themeLink.getAttribute('data-mode')) {
            case 'dark':
              setActiveTheme('dark');
              localStorage.setItem('theme', 'dark');
              break;
            case 'light':
              setActiveTheme('light');
              localStorage.setItem('theme', 'light');
              break;
            default:
              setActiveTheme('default');
              localStorage.clear();
              break;
          }
        });
      });
      ///////////////////////////////////////////////////////////

      ////// set system default theme //////////////
      const setSystemDefaultTheme = () => {
        if (
          localStorage.getItem('color-theme') === 'dark' ||
          (!('color-theme' in localStorage) &&
            window.matchMedia('(prefers-color-scheme: dark)').matches)
        ) {
          mainContainer.classList.add('dark');
        } else {
          mainContainer.classList.remove('dark');
        }
      };
      ////////////////////////////////////////////

      ////// handle System default theme change //////////////////
      window
        .matchMedia('(prefers-color-scheme: dark)')
        .addEventListener('change', function () {
          if (
            document
              .querySelector('.active-theme')
              .getAttribute('data-mode') === 'system'
          ) {
            setSystemDefaultTheme();
          }
        });
      ////////////////////////////////////////////////////////////////
    </script>
  </body>
</html>
